!function(o){o.URL=o.URL||o.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;function r(t,e){(e=e||{}).sampleBits=e.sampleBits||16,e.sampleRate=e.sampleRate||16e3;var n=new(o.webkitAudioContext||o.AudioContext),a=n.createMediaStreamSource(t),r=(n.createScriptProcessor||n.createJavaScriptNode).apply(n,[4096,1,1]),i={size:0,buffer:[],inputSampleRate:n.sampleRate,inputSampleBits:16,outputSampleRate:e.sampleRate,outputSampleBits:e.sampleBits,input:function(t){this.buffer.push(new Float32Array(t)),this.size+=t.length},compress:function(){for(var t=new Float32Array(this.size),e=0,n=0;n<this.buffer.length;n++)t.set(this.buffer[n],e),e+=this.buffer[n].length;for(var a=parseInt(this.inputSampleRate/this.outputSampleRate),r=t.length/a,i=new Float32Array(r),o=0,s=0;o<r;)i[o]=t[s],s+=a,o++;return i},encodeWAV:function(){function t(t){for(var e=0;e<t.length;e++)o.setUint8(s+e,t.charCodeAt(e))}var e=Math.min(this.inputSampleRate,this.outputSampleRate),n=Math.min(this.inputSampleBits,this.outputSampleBits),a=this.compress(),r=a.length*(n/8),i=new ArrayBuffer(44+r),o=new DataView(i),s=0;if(t("RIFF"),s+=4,o.setUint32(s,36+r,!0),s+=4,t("WAVE"),s+=4,t("fmt "),s+=4,o.setUint32(s,16,!0),s+=4,o.setUint16(s,1,!0),s+=2,o.setUint16(s,1,!0),s+=2,o.setUint32(s,e,!0),s+=4,o.setUint32(s,e*(n/8),!0),s+=4,o.setUint16(s,n/8*1,!0),s+=2,o.setUint16(s,n,!0),s+=2,t("data"),s+=4,o.setUint32(s,r,!0),s+=4,8===n)for(var u=0;u<a.length;u++,s++){var c=(p=Math.max(-1,Math.min(1,a[u])))<0?32768*p:32767*p;c=parseInt(255/(65535/(c+32768))),o.setInt8(s,c,!0)}else for(u=0;u<a.length;u++,s+=2){var p=Math.max(-1,Math.min(1,a[u]));o.setInt16(s,p<0?32768*p:32767*p,!0)}return new Blob([o],{type:"audio/wav"})}};this.start=function(){a.connect(r),r.connect(n.destination)},this.stop=function(){r.disconnect()},this.getBlob=function(){return this.stop(),i.encodeWAV()},this.play=function(t){t.src=o.URL.createObjectURL(this.getBlob())},this.upload=function(t,e){var n=new FormData;n.append("audioData",this.getBlob());var a=new XMLHttpRequest;e&&(a.upload.addEventListener("progress",function(t){e("uploading",t)},!1),a.addEventListener("load",function(t){e("ok",t)},!1),a.addEventListener("error",function(t){e("error",t)},!1),a.addEventListener("abort",function(t){e("cancel",t)},!1)),a.open("POST",t),a.send(n)},r.onaudioprocess=function(t){i.input(t.inputBuffer.getChannelData(0))}}r.throwError=function(t){throw alert(t),new function(){this.toString=function(){return t}}},r.canRecording=null!=navigator.getUserMedia,r.get=function(n,a){if(n){if(!navigator.getUserMedia)return void r.throwErr("当前浏览器不支持录音功能。");navigator.getUserMedia({audio:!0},function(t){var e=new r(t,a);n(e)},function(t){switch(t.code||t.name){case"PERMISSION_DENIED":case"PermissionDeniedError":r.throwError("用户拒绝提供信息。");break;case"NOT_SUPPORTED_ERROR":case"NotSupportedError":r.throwError("浏览器不支持硬件设备。");break;case"MANDATORY_UNSATISFIED_ERROR":case"MandatoryUnsatisfiedError":r.throwError("无法发现指定的硬件设备。");break;default:r.throwError("无法打开麦克风。异常信息:"+(t.code||t.name))}})}},o.HZRecorder=r}(window);
!function r(a,c,u){function d(t,e){if(!c[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var i=c[t]={exports:{}};a[t][0].call(i.exports,function(e){return d(a[t][1][e]||e)},i,i.exports,r,a,c,u)}return c[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)d(u[e]);return d}({1:[function(e,t,n){"use strict";t.exports=e("./recorder-identify").RIdentify},{"./recorder-identify":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var o=n.RIdentify=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.riConfig={numChannels:1,mimeType:"audio/wav",bitRate:16,sampleRate:16e3},this.ri_id="rIdentify",console.log(t);var i=this,r=t.id||i.ri_id;Object.assign(this.riConfig,t.config);var a=t.url||"/robot/rs/qa/asr",c=1e3*(t.time||21),u=0,d=null,l=null;HZRecorder.get(function(e){l=e}),function(e,t,n){if(function(){{if("micromessenger"!=navigator.userAgent.toLowerCase().match(/MicroMessenger/i))return;var e=document.createElement("meta");return e.name="viewport",e.content="width=device-width, initial-scale=1, user-scalable=0",document.head.appendChild(e),1}}()){var o;document.getElementById(e).addEventListener("touchstart",function(e){clearTimeout(o),t(),o=setTimeout(function(){n()},c),e.preventDefault()}),document.getElementById(e).addEventListener("touchmove",function(e){n(),clearTimeout(o),o=0}),document.getElementById(e).addEventListener("touchend",function(e){if(n(),clearTimeout(o),0!=o)return console.log("只是单纯的点击"),!1})}else document.getElementById(e).addEventListener("mousedown",t),document.getElementById(e).addEventListener("mouseup",n)}(r,function(e){p()?m("IE浏览器暂不支持录音！"):function(){s&&(clearInterval(s),s=null);l?(l.start(),setTimeout(function(){m(f+".")},200),s=setInterval(function(){m(f+=".")},800),u=new Date,d=setInterval(function(){u&&(new Date).getTime()-u.getTime()>=c&&n()},c)):m("未打开录音")}()},function(e){p()?m("IE浏览器暂不支持录音！"):(n(),HZRecorder.get(function(e){l=e}))}),document.getElementById(document.getElementById(r).getAttribute("data-search-id")).addEventListener("change",function(e){console.log("change事件：",e.target.value)});var s=null,f="";function n(){if(clearInterval(s),s=null,f="",l){l.stop();var e=l.getBlob();if(clearInterval(d),u&&(new Date).getTime()-u.getTime()<1e3)return void(u=0);if(u=0,e.size<2e4)return void m("录音太短不可用！");t=e,n=new FormData,o=i.riConfig.mimeType?i.riConfig.mimeType.split("/")[1]:"wav",n.append("file",t,(new Date).getTime()+"."+o),function(e){(e=e||{}).type=e.type.toUpperCase()||"GET",e.url=e.url||"",e.async=e.async||!0,e.data=e.data||null,e.success=e.success||function(){},e.error=e.error||function(e){console.log(e)};var t=null;t=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.xhr");if(t.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=(e.loaded/e.total*100).toFixed(0);console.log("上传进度：",t,"%")}},!1),t.addEventListener("readystatechange",function(){4==t.readyState&&200==t.status&&e.success(t.response)}),"POST"===e.type.toUpperCase())t.open(e.type,e.url,e.async),t.send(e.data);else if("GET"===e.type.toUpperCase()){var n=[];for(var o in e.data)n.push(o+"="+e.data[o]);var i=n.join("&");t.open(e.type,e.url+"?"+i,e.async),t.send(null)}}({url:a,type:"post",data:n,processData:!1,contentType:!1,success:function(e){if((e=JSON.parse(e)).data){var t=document.getElementById(r).getAttribute("data-search-id");t&&(document.getElementById(t).value=e.data,function(e,t){if("object"==(void 0===e?"undefined":g(e)))if(t=t.replace(/^on/i,""),document.all)t="on"+t,e.triggerEvent(t);else{var n=document.createEvent("HTMLEvents");n.initEvent(t,!0,!0),e.dispatchEvent(n)}}(document.getElementById(t),"change"))}},error:function(e){console.log(e)}})}var t,n,o}var o=null;function m(e){var t=document.getElementById("rIdentifyTip");t&&(t.parentNode.removeChild(t),o&&clearTimeout(o)),(t=document.createElement("div")).id="rIdentifyTip",t.style.cssText="position: fixed; top: "+(document.getElementById(r).getBoundingClientRect().top-20)+"px;left: "+document.getElementById(r).getBoundingClientRect().left+"px;border-radius: 8px;margin-top: -15px;color: #fff;background-color: #409eff;padding: 5px 0;z-index: 2147483647;";var n=document.createElement("span");n.innerText=e,n.title=e,n.style.cssText="margin: 0 10px;white-space: nowrap;",t.appendChild(n),document.getElementById(r).parentNode.appendChild(t),o=setTimeout(function(){(t=document.getElementById("rIdentifyTip")).parentNode.removeChild(t)},1e3)}function p(){return window.navigator.userAgentbw&&0<=window.navigator.userAgentbw.indexOf("MSIE")||"ActiveXObject"in window}};window.RIdentify&&(window.RIdentify=null),window.RIdentify=o,n.default=o},{}]},{},[1]);